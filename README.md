# Ops Agent - 智能运维问答机器人

Ops Agent 是一个基于 RAG（检索增强生成）技术的智能运维问答助手，专为运维场景设计。它支持多模态（文本+图片）交互、严格的权限管理（RBAC）、知识库自动学习与人工补全，并提供完整的内网离线部署方案。

## 🚀 核心功能 (Core Features)

### 1. 智能问答 (Smart Chat)
- **多模态交互**：支持纯文本提问，也支持上传运维截图、架构图（内置图片裁剪工具）。
- **精准检索 (RAG)**：基于 `pgvector` 向量数据库，精准检索相关文档片段。
- **文档溯源**：每次回答均标注参考来源，并提供源文件直接下载链接。
- **防幻觉机制**：针对图片问题，采用"视觉模型提取文本 + 文本模型生成答案"的双阶段策略。

### 2. 知识库管理 (Knowledge Management)
- **多格式支持**：支持 PDF, DOCX, TXT, MD, XLSX 等格式。
- **在线预览**：在“知识文档”模块中，可直接在线预览 DOCX、PDF 等文档内容，无需下载。
- **热度统计**：自动统计文档下载/引用次数，展示热门文档。
- **双向同步**：支持后台自动扫描磁盘文件增量更新数据库。

### 3. 自我进化 (Self-Learning)
- **未知问题捕获**：自动记录系统无法回答的问题。
- **问答补全**：管理员或用户可手动补充问答对。
- **AI 润色**：在补充答案时，提供 **AI 润色** 功能，利用大模型自动优化语言表达，使其更专业。
- **学习记录**：所有补充的知识点经审批后自动入库，并在“学习记录”中留痕。

### 4. 权限与审批 (RBAC & Approval)
- **Admin (管理员)**：全权管理，包括文档审批、问答审批、用户管理。
- **User (普通用户)**：可使用问答、上传文档（需审批）、提交补充回答（需审批）。
- **Guest (访客)**：仅限有限次数的问答，禁止上传。

## 📂 菜单导航 (Menu Structure)

项目前端采用侧边栏导航，根据用户角色动态显示菜单：

| 菜单项 | 适用角色 | 功能描述 |
| :--- | :--- | :--- |
| **智能问答** | All | 核心对话界面，支持图片上传/裁剪。 |
| **审批中心** | Admin | **文档审批**：审核用户上传的文件。<br>**问答审批**：审核用户提交的补全问答。 |
| **未知问题** | Admin, User | 查看系统未解答的问题列表。管理员可直接解答或丢弃；用户提交解答需审批。 |
| **问答补全** | Admin, User | 手动录入 Q&A 知识对。支持 **AI 润色** 功能。 |
| **问答记录** | Admin, User | 查看历史对话日志。管理员可看全局，用户仅看自己。 |
| **学习记录** | Admin, User | 查看所有通过“未知问题”或“问答补全”习得的知识条目。 |
| **知识文档** | Admin, User | 浏览全量知识库文件。支持 **在线预览**、搜索过滤、热门下载排行。 |

## 🛠️ 技术栈 (Tech Stack)

- **Frontend**: React, Vite, TailwindCSS, Lucide Icons, Framer Motion
- **Backend**: FastAPI, LangChain, SQLAlchemy
- **Database**: PostgreSQL (with `pgvector` extension)
- **LLM**: 支持 OpenAI 接口格式的模型 (如 GLM-4, DeepSeek, Qwen 等)
- **Deployment**: Docker, PyInstaller (单文件离线包)

## 📦 部署与运行 (Deployment)

### 快速启动 (Quick Start)

详细部署步骤（包括数据库初始化、内网穿透配置等）请参考 [DEPLOY.md](DEPLOY.md)。

**1. 后端启动**
```bash
cd backend
# 安装依赖
pip install -r requirements.txt
# 启动服务 (默认端口 8000)
python main.py
```

**2. 前端启动**
```bash
cd frontend
# 安装依赖
npm install
# 开发模式启动
npm run dev
```

### 内网离线部署
对于无法连接互联网的内网环境，本项目提供了全量打包脚本，生成单文件可执行程序。
详细指南请参考 [INTRANET_GUIDE.md](INTRANET_GUIDE.md)。

## 📝 最近更新 (Latest Updates)

- **[重构] 侧边栏导航**：采用分组分级结构（智能助手/知识共建/运维管理），提升易用性。
- **[新增] 全局日志**：管理员可查看所有用户的交互日志（提问、审批、文档上传）。
- **[优化] 进化历程管理**：管理员可删除学习记录，并同步清理向量数据库。
- **[新增] AI 润色功能**：在“问答补全”中引入大模型辅助写作。
- **[新增] 文档在线预览**：前端集成 `docx-preview`，解决下载查看的繁琐。
- **[优化] 审批工作流**：普通用户提交的知识贡献（文档/问答）均纳入审批流。
